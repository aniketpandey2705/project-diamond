<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prahari | Enterprise Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <nav class="navbar-premium">
        <div class="container-fluid px-4">
            <div class="d-flex align-items-center">
                <div class="logo-container">
                    <i class="fas fa-shield-halved"></i>
                    <span class="logo-text">PRAHARI</span>
                    <span class="logo-subtitle">Blockchain Governance</span>
                </div>
            </div>
            <div class="d-flex align-items-center gap-4">
                <div class="node-status">
                    <span class="pulse-dot"></span>
                    <span class="node-text">Node Active</span>
                </div>
                <div class="blockchain-badge">
                    <i class="fas fa-cube"></i>
                    <span>{{ chain_len }} Blocks</span>
                </div>
                <a href="/verify_blockchain" class="verify-btn">
                    <i class="fas fa-shield-check"></i>
                    <span>Verify Chain</span>
                </a>
            </div>
        </div>
    </nav>

    <div class="main-container">
        <div class="stats-grid">
            <div class="stat-card stat-card-primary">
                <div class="stat-icon"><i class="fas fa-file-lines"></i></div>
                <div class="stat-content">
                    <div class="stat-label">Total Grievances</div>
                    <div class="stat-value">{{ db|length }}</div>
                    <div class="stat-trend"><i class="fas fa-arrow-up"></i> Active Cases</div>
                </div>
            </div>
            <div class="stat-card stat-card-success">
                <div class="stat-icon"><i class="fas fa-link"></i></div>
                <div class="stat-content">
                    <div class="stat-label">Blocks Mined</div>
                    <div class="stat-value">{{ chain_len }}</div>
                    <div class="stat-trend"><i class="fas fa-check-circle"></i> Immutable</div>
                </div>
            </div>
            <div class="stat-card stat-card-info">
                <div class="stat-icon"><i class="fas fa-server"></i></div>
                <div class="stat-content">
                    <div class="stat-label">System Health</div>
                    <div class="stat-value">99.9%</div>
                    <div class="stat-trend"><i class="fas fa-heartbeat"></i> Operational</div>
                </div>
            </div>
        </div>

        <div class="search-section">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="searchInput" class="search-input" placeholder="Search by Ticket ID, Status, or Category...">
            </div>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all"><i class="fas fa-list"></i> All</button>
                <button class="filter-btn" data-filter="Pending"><i class="fas fa-clock"></i> Pending</button>
                <button class="filter-btn" data-filter="Processing"><i class="fas fa-spinner"></i> Processing</button>
                <button class="filter-btn" data-filter="Resolved"><i class="fas fa-check"></i> Resolved</button>
            </div>
        </div>

        {% if not db %}
        <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <h3>No Grievances Yet</h3>
            <p>Waiting for incoming calls to populate the dashboard...</p>
        </div>
        {% else %}
        <div class="grievances-grid" id="grievancesGrid">
            {% for id, info in db.items() %}
            <div class="grievance-card" data-id="{{ id }}" data-status="{{ info.status }}" data-priority="{% if 'High' in info.ai_report %}high{% elif 'Medium' in info.ai_report %}medium{% elif 'Low' in info.ai_report %}low{% else %}normal{% endif %}">
                <div class="card-header-custom">
                    <div class="ticket-id"><i class="fas fa-hashtag"></i><span>{{ id }}</span></div>
                    <span class="status-badge status-{{ info.status|lower }}">{{ info.status }}</span>
                </div>
                <div class="priority-bar priority-{% if 'High' in info.ai_report %}high{% elif 'Medium' in info.ai_report %}medium{% elif 'Low' in info.ai_report %}low{% else %}normal{% endif %}"></div>
                <div class="location-section" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border-radius: 12px; padding: 1rem; margin-bottom: 1rem; border: 1px solid #fbbf24;">
                    <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; color: #92400e; font-weight: 700; font-size: 0.875rem;">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Location Details</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; font-size: 0.875rem;">
                        <div>
                            <div style="color: #78350f; font-weight: 600; margin-bottom: 0.25rem;">State</div>
                            <div style="color: #92400e;">{{ info.state }}</div>
                        </div>
                        <div>
                            <div style="color: #78350f; font-weight: 600; margin-bottom: 0.25rem;">City</div>
                            <div style="color: #92400e;">{{ info.city }}</div>
                        </div>
                        <div>
                            <div style="color: #78350f; font-weight: 600; margin-bottom: 0.25rem;">Area</div>
                            <div style="color: #92400e;">{{ info.location }}</div>
                        </div>
                    </div>
                </div>
                <div class="ai-section">
                    <div class="ai-header"><i class="fas fa-robot"></i><span>AI Analysis Report</span></div>
                    <div class="ai-content">{{ info.ai_report }}</div>
                </div>
                <div class="audio-section">
                    <div class="audio-label"><i class="fas fa-microphone"></i> Voice Recording</div>
                    <audio controls class="custom-audio-player">
                        <source src="{{ info.url }}" type="audio/wav">
                        <source src="{{ info.url }}" type="audio/mpeg">
                    </audio>
                </div>
                <div class="hash-section">
                    <div class="hash-label">
                        <i class="fas fa-fingerprint"></i> Blockchain Proof
                        <span class="verified-badge"><i class="fas fa-shield-check"></i> Verified</span>
                    </div>
                    <div class="hash-container">
                        <code class="hash-code" id="hash-{{ id }}">{{ info.hash }}</code>
                        <button class="copy-btn" onclick="copyHash('{{ id }}', '{{ info.hash }}')" title="Copy to clipboard"><i class="fas fa-copy"></i></button>
                    </div>
                </div>
                <form action="/update_status" method="POST" class="action-form">
                    <input type="hidden" name="g_id" value="{{ id }}">
                    <div class="action-group">
                        <select name="new_status" class="status-select">
                            <option value="Pending" {% if info.status=='Pending' %}selected{% endif %}>Pending</option>
                            <option value="Processing" {% if info.status=='Processing' %}selected{% endif %}>Processing</option>
                            <option value="Resolved" {% if info.status=='Resolved' %}selected{% endif %}>Resolved</option>
                            <option value="Rejected" {% if info.status=='Rejected' %}selected{% endif %}>Rejected</option>
                        </select>
                        <button type="submit" class="update-btn"><i class="fas fa-sync-alt"></i> Update</button>
                    </div>
                </form>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/admin.js"></script>
</body>
</html>
""